<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem JO v4.7 - Enterprise</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

<div class="sidebar">
    <div class="logo">FREELANCE OS AND PROJECT TRACKING</div>
    
    <div class="menu-item active" id="menu-board" onclick="switchView('board')">
        <span>ğŸ“‹ Workflow Board</span>
    </div>
    
    <div class="menu-section-title">KEUANGAN</div>
    <div class="menu-item" id="menu-salary" onclick="switchView('salary')">
        <span>ğŸ’° Active Period</span>
    </div>
    <div class="menu-item" id="menu-done" onclick="switchView('done')">
        <span>âœ… History & Done</span>
    </div>
    
    <div style="margin-top:auto; border-top:1px solid #333; padding-top:15px; margin-bottom:10px;">
        <button class="btn btn-outline btn-sm" onclick="downloadBackup()">ğŸ’¾ Backup Data</button>
        <button class="btn btn-outline btn-sm" style="margin-top:5px; border-color:#555; color:#888;" onclick="document.getElementById('file-input').click()">ğŸ“‚ Restore Data</button>
        <input type="file" id="file-input" style="display:none" onchange="restoreBackup(this)">
    </div>

    <div style="font-size:10px; color:#555; text-align:center;">
        v4.7 - Workflow Lock<br>Taufik System
    </div>
</div>

<div class="main" id="view-board">
    <div class="header-tools">
        <h2>Production Board</h2>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-outline" onclick="openManualJob()">+ Job Manual</button>
            <button class="btn" onclick="openTargetCalc()">ğŸ¯ Target (Auto-Limit)</button>
            <button class="btn" onclick="generateWeeklyTarget()">ğŸ”„ Auto Weekly</button>
        </div>
    </div>

    <div class="board">
        <div class="column">
            <div class="col-header">1. Scheduling <span class="col-count" id="c-scheduling">0</span></div>
            <div class="col-body" id="col-scheduling"></div>
        </div>
        <div class="column">
            <div class="col-header">2. Preparing <span class="col-count" id="c-preparing">0</span></div>
            <div class="col-body" id="col-preparing"></div>
        </div>
        <div class="column">
            <div class="col-header">3. On Progress <span class="col-count" id="c-progress">0</span></div>
            <div class="col-body" id="col-progress"></div>
        </div>
        <div class="column">
            <div class="col-header">4. Review Klien <span class="col-count" id="c-review">0</span></div>
            <div class="col-body" id="col-review"></div>
        </div>
        <div class="column">
            <div class="col-header">5. Upload <span class="col-count" id="c-upload">0</span></div>
            <div class="col-body" id="col-upload"></div>
        </div>
    </div>
</div>

<div class="main" id="view-salary" style="display:none;">
    <div class="header-tools">
        <h2>Active Period</h2>
        <button class="btn" onclick="openAdjustModal()">+ Adjust (Konten)</button>
    </div>
    <div class="tab-container">
        <button class="tab-btn active" onclick="switchTab('salary', 'content')">Konten Kreator</button>
        <button class="tab-btn" onclick="switchTab('salary', 'general')">Freelance General</button>
    </div>
    <div id="salary-content" class="tab-content active"><div id="salary-dashboard-content"></div></div>
    <div id="salary-general" class="tab-content"><div id="salary-dashboard-general"></div></div>
</div>

<div class="main" id="view-done" style="display:none;">
    <div class="header-tools">
        <h2>History & Arsip</h2>
    </div>
    <div class="salary-card" style="border-color: var(--success);">
        <h3 style="margin-bottom:10px; color:#aaa;">Total Pendapatan (Lifetime)</h3>
        <h1 class="total-display" id="grand-total">Rp 0</h1>
    </div>
    <div class="tab-container">
        <button class="tab-btn active" onclick="switchTab('history', 'content')">History Konten</button>
        <button class="tab-btn" onclick="switchTab('history', 'general')">History Freelance</button>
    </div>
    <div id="history-content" class="tab-content active"><div id="history-dashboard-content"></div></div>
    <div id="history-general" class="tab-content"><div id="history-dashboard-general"></div></div>
</div>

<div class="modal" id="modal-detail">
    <div class="modal-content" style="width:750px;">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
                <h3 id="det-title" style="margin-bottom:5px; border:none;">Job Title</h3>
                <div style="font-size:11px; color:#888;">Batch: <span id="det-batch">-</span></div>
            </div>
            <div style="text-align:right;">
                <span id="det-cat" class="badge">Category</span>
                <div id="det-deadline-badge" style="margin-top:5px; font-size:11px; font-weight:bold;"></div>
            </div>
        </div>
        
        <div class="path-box"><small>ğŸ“‚ Lokasi Penyimpanan:</small><code id="det-path">...</code></div>
        
        <div id="portfolio-section" style="display:none; margin-bottom:15px; background:#1e2b34; padding:10px; border-radius:4px; border:1px solid #3498db;">
            <label style="font-size:11px; color:#3498db; font-weight:bold;">ğŸ”— LINK PORTOFOLIO</label>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <input type="text" id="det-portfolio-input" placeholder="Paste Link..." style="font-size:12px;">
                <button class="btn btn-sm" style="width:auto;" onclick="savePortfolioLink()">Simpan</button>
            </div>
            <div id="det-portfolio-display" style="margin-top:5px; font-size:12px;"></div>
        </div>

        <table class="detail-table">
            <tr><td>Tipe</td><td id="det-type">-</td></tr>
            <tr><td>Deadline</td><td id="det-deadline">-</td></tr>
            <tr><td>Referensi</td><td id="det-ref" class="link-text">-</td></tr>
            <tr><td>Link Preview (QC)</td><td id="det-link" class="link-text">-</td></tr>
        </table>

        <div class="history-section" style="margin-top:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:10px; margin-bottom:15px;">
                <h4 style="font-size:14px; margin:0;">ğŸ“œ Communication Log</h4>
                <button class="btn btn-sm" style="width:auto; padding:6px 12px;" onclick="openQuickNote()">+ Tulis Catatan</button>
            </div>
            <div id="history-log-container" style="max-height:300px; overflow-y:auto; padding-right:5px;"></div>
        </div>
        
        <div style="text-align:right; margin-top:20px;">
            <button class="btn btn-danger" onclick="closeModal('modal-detail')">Tutup</button>
        </div>
    </div>
</div>

<div class="modal" id="modal-period-link">
    <div class="modal-content" style="width:450px;">
        <h3>ğŸ”— Link Hasil Pekerjaan (Master)</h3>
        <p style="font-size:12px; color:#aaa; margin-bottom:15px;">Link ini wajib diisi untuk membuka fitur PDF & Finalisasi.</p>
        <input type="hidden" id="pl-period-key">
        <input type="hidden" id="pl-category-key">
        <div class="form-group">
            <label>Link Folder Cloud (GDrive/Dropbox)</label>
            <input type="text" id="pl-link" placeholder="https://...">
        </div>
        <div style="text-align:right; margin-top:20px;">
            <button class="btn btn-danger" onclick="closeModal('modal-period-link')">Batal</button>
            <button class="btn" onclick="savePeriodLink()">Simpan Link</button>
        </div>
    </div>
</div>

<div class="modal" id="modal-quick-note" style="z-index: 2005;">
    <div class="modal-content" style="width:450px;">
        <h3>Tambah Catatan</h3>
        <div class="form-group">
            <label>Jenis Catatan</label>
            <select id="quick-note-type">
                <option value="internal">ğŸ”µ Internal (Tim)</option>
                <option value="client">ğŸŸ  Klien / Revisi</option>
            </select>
        </div>
        <div class="form-group">
            <label>Isi Catatan</label>
            <textarea id="quick-note-text" rows="5" placeholder="Tulis detail catatan di sini..."></textarea>
        </div>
        <div style="text-align:right; margin-top:10px;">
            <button class="btn btn-danger" onclick="closeModal('modal-quick-note')">Batal</button>
            <button class="btn" onclick="saveQuickNote()">Simpan</button>
        </div>
    </div>
</div>

<div class="modal" id="modal-adjust">
    <div class="modal-content" style="width:450px;">
        <h3>Input Penyesuaian (Konten)</h3>
        <div class="form-group"><label>Keterangan</label><input type="text" id="adj-title" placeholder="Cth: Transport, Bonus"></div>
        <div class="form-group"><label>Nominal (Rp)</label><input type="number" id="adj-nominal" placeholder="100000"></div>
        <div class="form-group"><label>Tanggal / Rentang Waktu</label><input type="text" id="adj-date-range" placeholder="Cth: 08-12 Feb 2026"></div>
        <div class="form-group"><label>Pekan Ke-</label><select id="adj-week"><option value="1">Pekan 1</option><option value="2">Pekan 2</option><option value="3">Pekan 3</option><option value="4">Pekan 4</option></select></div>
        <div class="form-group"><label>Catatan</label><textarea id="adj-note" rows="2"></textarea></div>
        <div style="text-align:right;"><button class="btn btn-danger" onclick="closeModal('modal-adjust')">Batal</button><button class="btn" onclick="saveAdjustment()">Simpan</button></div>
    </div>
</div>

<div class="modal" id="modal-manual">
    <div class="modal-content">
        <h3>Buat JO Manual</h3>
        <div class="form-group">
            <label>Kategori</label>
            <select id="man-category" onchange="toggleManualTypes()">
                <option value="General">Freelance General</option>
                <option value="Content">Konten Kreator</option>
            </select>
        </div>
        <div class="form-group"><label>Judul Job</label><input type="text" id="man-title"></div>
        <div class="form-group"><label>Tipe Job</label><select id="man-type"></select></div>
        <div class="form-group" id="man-nominal-group"><label>Nominal (Rp)</label><input type="number" id="man-price"></div>
        <div class="form-group"><label>Deadline</label><input type="date" id="man-deadline"></div>
        <div style="text-align:right;"><button class="btn btn-danger" onclick="closeModal('modal-manual')">Batal</button><button class="btn" onclick="saveManualJob()">Simpan</button></div>
    </div>
</div>

<div class="modal" id="modal-target">
    <div class="modal-content">
        <h3>ğŸ¯ Target Income</h3>
        <p style="font-size:12px; color:#aaa; margin-bottom:15px;">Sistem akan membatasi sesuai kapasitas produksi (Max ~Rp 1.2jt/minggu).</p>
        <div class="form-group"><label>Target (Rp)</label><input type="number" id="target-money"></div>
        <div style="text-align:right;"><button class="btn btn-danger" onclick="closeModal('modal-target')">Batal</button><button class="btn" onclick="generateByTarget()">Generate</button></div>
    </div>
</div>

<div class="modal" id="modal-finalize">
    <div class="modal-content" style="width:500px;">
        <h3>ğŸ§¹ Finalisasi Periode</h3>
        <input type="hidden" id="fin-period-key">
        <input type="hidden" id="fin-category-key">
        <div style="background:#f4f6f9; padding:15px; border-radius:8px; border:1px solid #ddd; margin-bottom:15px;">
            <p style="font-size:12px; font-weight:bold; margin-bottom:5px; color:#555;">Link Bukti Kerja (Cloud):</p>
            <a id="fin-display-link" href="#" target="_blank" style="color:#456d91; font-weight:bold; font-size:14px; text-decoration:underline; word-break:break-all;">Checking...</a>
        </div>
        <div style="background:#333; padding:15px; border-radius:5px; margin-top:10px; color:white;">
            <div class="checklist-item"><input type="checkbox" id="check-cloud"><label for="check-cloud" style="color:white;">File Master sudah aman di Cloud</label></div>
            <div class="checklist-item"><input type="checkbox" id="check-master"><label for="check-master" style="color:white;">File Local sudah dihapus</label></div>
        </div>
        <div style="text-align:right; margin-top:15px;">
            <button class="btn btn-danger" onclick="closeModal('modal-finalize')">Batal</button>
            <button class="btn" style="background:var(--success); color:white" onclick="executeFinalize()">âœ… Tutup Periode</button>
        </div>
    </div>
</div>

<div class="modal" id="modal-prep"><div class="modal-content" style="width:500px;"><h3>Stage 2: Preparing</h3><input type="hidden" id="prep-id"><div class="form-group"><label>Link Referensi</label><input type="text" id="prep-ref"></div><div class="form-group"><label>Deadline</label><input type="date" id="prep-deadline"></div><div class="form-group"><label>ğŸ“ Catatan Internal</label><textarea id="prep-notes-internal" rows="4"></textarea></div><div class="form-group" id="slide-group"><label>Jml Slide (Feed)</label><input type="number" id="prep-slides" value="1"></div><div style="text-align:right;"><button class="btn btn-danger" onclick="closeModal('modal-prep')">Batal</button><button class="btn" onclick="savePreparing()">Mulai</button></div></div></div>
<div class="modal" id="modal-prog"><div class="modal-content"><h3>QC & Preview</h3><input type="hidden" id="prog-id"><div class="form-group"><label>Link Preview (WAJIB DIISI)</label><input type="text" id="prog-link" placeholder="http://..."></div><div style="text-align:right;"><button class="btn btn-danger" onclick="closeModal('modal-prog')">Batal</button><button class="btn" onclick="saveProgress()">Kirim Review</button></div></div></div>
<div class="modal" id="modal-rev"><div class="modal-content" style="width:500px;"><h3>Keputusan Klien</h3><input type="hidden" id="rev-id"><div class="form-group"><label>ğŸ’¬ Catatan Klien</label><textarea id="rev-notes-client" rows="4"></textarea></div><div style="display:flex; gap:10px; margin-top:20px;"><button class="btn btn-danger" style="flex:1" onclick="saveReview('revisi')">Revisi</button><button class="btn" style="flex:1; background:var(--success); color:white;" onclick="saveReview('oke')">ACC</button></div></div></div>

<div id="pdf-template-container" style="display:none;">
    <div id="pdf-template" style="width: 100%; font-family: 'Inter', sans-serif; color: #333; padding: 40px; background: white;">
        
        <div style="border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; display:flex; justify-content:space-between;">
            <div>
                <h2 style="margin: 0; font-weight: 700; font-size: 24px;">INVOICE REPORT</h2>
                <div style="margin-top:5px; font-size:12px; color:#555;">Professional Creative Services</div>
            </div>
            <div style="text-align:right;">
                <h3 style="margin:0; color:#456D91;">TAUFIK SYSTEM</h3>
                <div style="font-size:12px; margin-top:5px;" id="pdf-period">Periode X</div>
            </div>
        </div>

        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
            <thead>
                <tr style="background: #f8f8f8; color: #000;">
                    <th style="text-align: left; padding: 12px; border-bottom: 1px solid #ddd; font-size: 11px; text-transform: uppercase; width: 15%;">Tanggal</th>
                    <th style="text-align: left; padding: 12px; border-bottom: 1px solid #ddd; font-size: 11px; text-transform: uppercase; width: 40%;">Deskripsi Job</th>
                    <th style="text-align: center; padding: 12px; border-bottom: 1px solid #ddd; font-size: 11px; text-transform: uppercase; width: 15%;">Qty / Slide</th>
                    <th style="text-align: left; padding: 12px; border-bottom: 1px solid #ddd; font-size: 11px; text-transform: uppercase; width: 15%;">Kategori</th>
                    <th style="text-align: right; padding: 12px; border-bottom: 1px solid #ddd; font-size: 11px; text-transform: uppercase; width: 15%;">Nominal</th>
                </tr>
            </thead>
            <tbody id="pdf-table-body"></tbody>
        </table>

        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
            <table style="width: 45%; border-collapse: collapse;">
                <tr><td style="padding: 8px; font-size: 13px;">Subtotal Konten:</td><td style="padding: 8px; font-size: 13px; text-align: right; font-weight:600;" id="pdf-subtotal">-</td></tr>
                <tr><td style="padding: 8px; font-size: 13px;">Adjustments/Lainnya:</td><td style="padding: 8px; font-size: 13px; text-align: right; font-weight:600;" id="pdf-adjust">-</td></tr>
                <tr style="border-top: 2px solid #333;"><td style="padding: 10px 8px; font-size: 16px; font-weight: 700;">TOTAL:</td><td style="padding: 10px 8px; font-size: 16px; font-weight: 700; text-align: right; color:#27ae60;" id="pdf-total">-</td></tr>
            </table>
        </div>

        <div style="margin-top: 40px; font-size: 11px; color: #777;">
            <p><strong>Link Bukti Pekerjaan:</strong> <span id="pdf-cloud-text">-</span></p>
        </div>
    </div>
</div>

<script src="assets/script.js"></script>
</body>
</html>